
@model EZRAC.Risk.UI.Web.ViewModels.Claims.NotesViewModel

<div class="modal fade cla-modpopup in" id="approvalPop" role="dialog" style="display: block; padding-left: 17px;vertical-align:middle;position:absolute">
    <div class="modal-dialog" style="width:480px;height:600px !important">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"></button>
                <h4 class="modal-title">Approve Claim</h4>
            </div>
            <div class="modal-body">
                <div>
                    <div class="bold">Add Note</div><br />
                    <div>
                        @Html.TextAreaFor(x => x.Description, new { style = "width:100%;height:200px;", id = "approveNoteDescription" })
                    </div>
                    <div id="errorDescription" class="errorMsg"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="approveNotes" class="btn btn1 pull-left top5 right20" data-dismiss="modal" data-url="@Url.Action("ApproveClaim", "Claims")">Approve</button>
                <button id="cancel" class="btn btn2 pull-left top5" data-dismiss="modal">CANCEL</button>
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="claimId" />


<script>
    $(document).ready(function () {
        var constants = {
            generalTypeId: 9,
            approve: true,
            reject: false,
        }

        $("#approveNotes").click(function () {
            if ($("#approveNoteDescription").val() == "") {
                $("#errorDescription").text("Please enter note");
                return false;
            }
            var claimId = $("#claimId").val();
            addQuickNotes(claimId, constants.generalTypeId, $("#approveNoteDescription").val(), false);
            approveOrRejectCLaim($(this).attr("data-url"), claimId);
            $('.modal').remove();
            $('.modal-backdrop').remove();
            $('body').removeClass("modal-open");
            $('#approvalPop').modal('hide');
        });

        $("#approveNoteDescription").on('input', function () {
            $("#errorDescription").text("");
        });
    });

    function addQuickNotes(claimNumber, type, description, notify) {
        var token = $('input[name="__RequestVerificationToken"]').val();

        var viewModel = {
            ClaimId: claimNumber,
            SelectedNoteTypeId: type,
            Description: description,
            SendNotification: notify,
            IsNotesTab: false,
            __RequestVerificationToken: token
        };

        $.ajax({
            url: addQuickNotesUrl,
            data: viewModel,
            type: "POST",
            cache: false,
            error: onErrorHandler,
        });
    }

</script>
